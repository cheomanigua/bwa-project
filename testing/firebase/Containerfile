# Use an official, clean base image with Node.js and Alpine
FROM node:20-alpine

# Install Java Runtime Environment (JRE) required for Firebase Emulators
RUN apk add --no-cache openjdk17-jre bash

# Install the Firebase CLI globally
# We use a specific version for stability (latest major is 13.x at time of writing)
RUN npm install -g firebase-tools@14.26.0
#RUN npm install -g firebase-tools@13.11.0

# Set the working directory
WORKDIR /app

# Switch to non-root user for security
USER node

# Expose ports (matching your compose file)
EXPOSE 4000 8080 9099

# Copy necessary files from the host into the container. 
# Note: In Docker, ensure these files exist in the same folder as the Containerfile
COPY --chown=node:node firebase.json firestore.rules firestore.indexes.json ./

# Define the entry point to run the emulators
ENTRYPOINT ["firebase"]
CMD ["emulators:start", "--project=my-test-project", "--only=auth,firestore"]
