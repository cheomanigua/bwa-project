podman compose up -d --force-recreate gcs-emulator content-uploader
podman compose logs content-uploader
>>>> Executing external compose provider "/usr/bin/podman-compose". Please see podman-compose(1) for how to disable this message. <<<<

[upload] Starting content upload...
[upload] Uploading: posts/week0003/index.html (plans: visitor)
ServiceException: 401 Anonymous caller does not have storage.objects.list access to the Google Cloud Storage bucket. Permission 'storage.objects.list' denied on resource (or it may not exist).

My Note: plan for week0003 should be elite, not visitor

-------

Troubleshooting to check if upload_posts.sh is fetching x-goog-meta-required-plans:

STEP 1
cheo@hal:~/code/hugo/project/testing$ podman run --rm --network testing_custom_app_network \
  -v "${PWD}:/app" \
  -w /app \
  -e GCS_BUCKET=content \
  -e GCS_EMULATOR_HOST=gcs-emulator:9000 \
  -e STORAGE_EMULATOR_HOST=http://gcs-emulator:9000 \
  google/cloud-sdk:slim \
  /bin/bash ./upload_posts.sh
  
  
[upload] Ensuring bucket exists...
[upload] Starting content upload...
[upload] Uploading gated: week0003 (plans: elite)
[upload] Uploading gated: week0001 (plans: basic,pro)
[upload] Uploading gated: week0002 (plans: basic)
[upload] Warning: HTML file not found for _index, skipping...
[upload] Upload complete.

STEP 2
cheo@hal:~/code/hugo/project/testing$ curl http://localhost:9000/storage/v1/b/content/o/posts%2Fweek0003%2Findex.html


{"kind":"storage#object","name":"posts/week0003/index.html","id":"content/posts/week0003/index.html","bucket":"content","size":"6401","contentType":"text/html","crc32c":"gzIlcA==","md5Hash":"p5U9enHQHtTZ6smj9AKPtQ==","etag":"p5U9enHQHtTZ6smj9AKPtQ==","storageClass":"STANDARD","timeCreated":"2025-12-22T09:22:04.384709Z","timeStorageClassUpdated":"2025-12-22T09:22:04.384712Z","updated":"2025-12-22T09:22:04.384712Z","generation":"1766395324384713","metadata":{"required-plans":"elite"},"selfLink":"http://0.0.0.0:9000/storage/v1/b/content/o/posts%2Fweek0003%2Findex.html","mediaLink":"http://0.0.0.0:9000/download/storage/v1/b/content/o/posts%2Fweek0003%2Findex.html?alt=media","metageneration":"1"}


STEP 3
curl http://localhost:8081/api/posts/week0003


STEP 4
podman logs go-backend | grep "Object \"posts/week0003/index.html\" exists"


STEP 5
create new post with no categories in front matter
hugo -D --minify
podman run --rm --network testing_custom_app_network \
  -v "${PWD}:/app" \
  -w /app \
  google/cloud-sdk:slim \
  /bin/bash ./upload_posts.sh

curl -v http://localhost:8081/posts/week0003
curl -v http://localhost:8081/posts/test
